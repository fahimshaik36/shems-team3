<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>My Devices | SHEMS</title>

<style>
:root {
  --bg: #f8fafc;
  --card: #ffffff;
  --text: #0f172a;
  --muted: #64748b;
  --primary: #2563eb;
  --border: #e5e7eb;
  --success: #16a34a;
  --danger: #dc2626;
}

body.dark { --bg:#0b1220; --card:#111827; --text:#f8fafc; --muted:#9ca3af; --border:#1f2937; }

body {
  margin:0;
  font-family:Inter,Segoe UI,system-ui,sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* Sidebar */
.sidebar {
  width:240px;
  height:100vh;
  background:#020617;
  position:fixed;
  padding:26px 0;
}
.sidebar h2 {
  text-align:center;
  margin-bottom:36px;
  font-size:18px;
  color:#fff;
}
.sidebar a {
  display:block;
  padding:14px 32px;
  color:#cbd5f5;
  text-decoration:none;
  font-size:14px;
  border-left:3px solid transparent;
}
.sidebar a:hover,
.sidebar a.active {
  background:rgba(255,255,255,0.05);
  border-left:3px solid var(--primary);
  color:white;
  font-weight:600;
}

.main { margin-left:240px; }

/* Topbar */
.topbar {
  height:84px;
  background:linear-gradient(90deg,#2563eb,#1e40af);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 44px;
  color:white;
}
.topbar-left h1 { margin:0; font-size:22px; }
.topbar-left p { margin:6px 0 0; font-size:13px; opacity:.9; }

.theme-switch {
  width:46px;height:24px;background:#bfdbfe;border-radius:20px;position:relative;cursor:pointer;
}
.theme-switch::before {
  content:"";position:absolute;width:18px;height:18px;background:white;border-radius:50%;top:3px;left:3px;transition:.3s;
}
body.dark .theme-switch { background:#60a5fa; }
body.dark .theme-switch::before { transform:translateX(22px); }

.content { padding:36px 48px; }

/* Cards */
.card, .table-box {
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:26px 30px;
  margin-bottom:30px;
  box-shadow:0 10px 30px rgba(15,23,42,0.06);
}

.card h2, .table-box h2 { margin:0 0 10px; }

/* Info box */
.info-box {
  background:rgba(37,99,235,0.08);
  border-left:4px solid var(--primary);
  padding:14px 18px;
  border-radius:8px;
  font-size:13px;
  margin:18px 0 20px;
}

/* Form */
.form-grid {
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:22px 26px;
}

.form-group label {
  font-size:13px;
  font-weight:600;
  margin-bottom:6px;
  display:block;
}

.form-group input,
.form-group select {
  padding:11px 12px;
  border-radius:8px;
  border:1px solid var(--border);
  font-size:14px;
  width:100%;
}

.custom-input {
  margin-top:8px;
  display:none;
}

.btn-primary {
  margin-top:22px;
  background:var(--primary);
  color:white;
  border:none;
  padding:11px 24px;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
}

/* Table */
table {
  width:100%;
  border-collapse:collapse;
  margin-top:16px;
}

th {
  text-align:left;
  font-size:12px;
  text-transform:uppercase;
  color:var(--muted);
  border-bottom:1px solid var(--border);
  padding-bottom:10px;
}

td {
  padding:14px 0;
  border-bottom:1px solid var(--border);
}

.status-on,
.status-off {
  padding:6px 12px;
  border-radius:20px;
  font-size:12px;
  font-weight:600;
}
.status-on { background:#dcfce7;color:var(--success); }
.status-off { background:#fee2e2;color:var(--danger); }

.btn {
  padding:6px 14px;
  border-radius:6px;
  font-size:12px;
  font-weight:600;
  text-decoration:none;
}

.toggle { background:var(--primary);color:white; }
.delete { border:1px solid var(--danger);color:var(--danger);margin-left:8px; }

.empty {
  text-align:center;
  padding:32px 0;
  color:var(--muted);
}

body.dark .card,
body.dark .table-box {
  box-shadow:0 10px 30px rgba(0,0,0,0.6);
}
</style>

<script>
function toggleTheme(){
  document.body.classList.toggle("dark");
  localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light");
}

function setPowerByType(select){
  const powerInput = document.getElementById("powerInput");
  const powerMap = {
    "Fan": 75,
    "Air Conditioner": 1500,
    "Light": 10,
    "Television": 120,
    "Refrigerator": 180,
    "Washing Machine": 500,
    "Heater": 2000,
    "Microwave": 1200,
    "Laptop": 65,
    "Water Pump": 750
  };
  powerInput.value = powerMap[select.value] || "";
}

function handleOther(select, inputId){
  const input = document.getElementById(inputId);
  if(select.value === "Other"){
    input.style.display = "block";
    input.required = true;
  } else {
    input.style.display = "none";
    input.required = false;
    input.value = "";
  }
}

window.onload=function(){
  if(localStorage.getItem("theme")==="dark"){
    document.body.classList.add("dark");
  }
}
</script>
</head>

<body>

<div class="sidebar">
  <h2>SHEMS</h2>
  <a href="/">Home</a>
  <a href="/dashboard">Dashboard</a>
  <a href="/devices" class="active">Devices</a>
  <a href="/analytics">Analytics</a>
  <a href="/schedules">Scheduling</a>
  <a th:href="@{/logout}">Logout</a>
</div>

<div class="main">
<div class="topbar">
  <div class="topbar-left">
    <h1>My Devices</h1>
    <p>Monitor and control all smart devices connected to your home.</p>
  </div>
  <div class="theme-switch" onclick="toggleTheme()"></div>
</div>

<div class="content">

<div class="card">
  <h2>Add a Smart Device</h2>
  <p>Enter your appliance details so SHEMS can monitor and control it.</p>

  <div class="info-box">
    Example: <b>Living Room AC</b> • Type: <b>Air Conditioner</b> • Location: <b>Bedroom</b> • Power: <b>1500W</b>
  </div>

  <form th:action="@{/devices/add}" th:object="${device}" method="post">
    <div class="form-grid">

      <!-- Device Name -->
      <div class="form-group">
        <label>Device Name</label>
        <select th:field="*{name}" onchange="handleOther(this,'customName')" required>
          <option value="">Select Device</option>
          <option value="Living Room AC">Living Room AC</option>
          <option value="Bedroom Fan">Bedroom Fan</option>
          <option value="Hall Light">Hall Light</option>
          <option value="Kitchen Refrigerator">Kitchen Refrigerator</option>
          <option value="Bathroom Geyser">Bathroom Geyser</option>
          <option value="Television">Television</option>
          <option value="Washing Machine">Washing Machine</option>
          <option value="Microwave">Microwave</option>
          <option value="Laptop">Laptop</option>
          <option value="Water Pump">Water Pump</option>
          <option value="Other">Other</option>
        </select>
        <input type="text" name="customName" id="customName" class="custom-input" placeholder="Enter device name">
      </div>

      <!-- Device Type -->
      <div class="form-group">
        <label>Device Type</label>
        <select th:field="*{type}" onchange="setPowerByType(this);handleOther(this,'customType')" required>
          <option value="">Select Type</option>
          <option value="Fan">Fan</option>
          <option value="Air Conditioner">Air Conditioner</option>
          <option value="Light">Light</option>
          <option value="Television">Television</option>
          <option value="Refrigerator">Refrigerator</option>
          <option value="Washing Machine">Washing Machine</option>
          <option value="Heater">Heater</option>
          <option value="Microwave">Microwave</option>
          <option value="Laptop">Laptop</option>
          <option value="Water Pump">Water Pump</option>
          <option value="Other">Other</option>
        </select>
        <input type="text" name="customType" id="customType" class="custom-input" placeholder="Enter device type">
      </div>

      <!-- Location -->
      <div class="form-group">
        <label>Installation Location</label>
        <select th:field="*{location}" onchange="handleOther(this,'customLocation')" required>
          <option value="">Select Location</option>
          <option value="Living Room">Living Room</option>
          <option value="Bedroom">Bedroom</option>
          <option value="Kitchen">Kitchen</option>
          <option value="Bathroom">Bathroom</option>
          <option value="Dining Room">Dining Room</option>
          <option value="Balcony">Balcony</option>
          <option value="Garage">Garage</option>
          <option value="Office Room">Office Room</option>
          <option value="Other">Other</option>
        </select>
        <input type="text" name="customLocation" id="customLocation" class="custom-input" placeholder="Enter custom location">
      </div>

      <div class="form-group">
        <label>Power Rating (Watts)</label>
        <input type="number" id="powerInput" th:field="*{powerRating}" placeholder="Auto-filled" required>
      </div>

    </div>
    <button type="submit" class="btn-primary">Add Device</button>
  </form>
</div>

<div class="table-box">
<h2>Connected Devices</h2>
<small>All registered smart devices linked to your account.</small>

<table>
<tr>
  <th>Name</th>
  <th>Type</th>
  <th>Location</th>
  <th>Status</th>
  <th>Actions</th>
</tr>

<tr th:each="device : ${devices}">
  <td th:text="${device.name}"></td>
  <td th:text="${device.type}"></td>
  <td th:text="${device.location}"></td>
  <td>
    <span th:if="${device.status}" class="status-on">ON</span>
    <span th:unless="${device.status}" class="status-off">OFF</span>
  </td>
  <td>
    <a th:href="@{'/devices/toggle/' + ${device.id}}" class="btn toggle">Toggle</a>
    <a th:href="@{'/devices/delete/' + ${device.id}}" class="btn delete">Delete</a>
  </td>
</tr>
</table>

<div th:if="${#lists.isEmpty(devices)}" class="empty">
  <strong>No devices found</strong><br>
  Add smart devices to start monitoring energy usage.
</div>
</div>

</div>
</div>
</body>
</html>

